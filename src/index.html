<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8"/>
  <title>RAG Challenge Submission API</title>
  <link rel="icon" type="image/x-icon" href="static/assets/fav_ttg.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
  <link rel="stylesheet" href="static/style.css">
</head>
<body>
<div class="success-banner" id="successBanner">
  <span class="close-button" onclick="hideBanner()">×</span>
  <p><b>Answers submitted!</b></p>
  <p id="submission-data"></p>
  <p id="tsp-verification-data" style="display: none"></p>
  <button type="button" id="copy-tsp-button" class="copy-button" onclick="copyCode('tsp-verification-data')">Copy data
    for TSP verification
  </button>
</div>

<div class="header">
  <img src="static/assets/ERC_header_8.png" alt="Logo">
</div>

<div class="content">
  <h1>Answer Submission</h1>

  <!-- Instructions -->
  <div class="collapsible-section">
    <button class="section-header">
      <svg class="arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <h2>Instructions</h2>
    </button>
    <div class="section-content" id="intro-text">
      <ol>
        <li>
          <strong>Adhere to the <a href="TODO add link" target="_blank">Submission Guidelines</a></strong>
        </li>
        <li>
          <strong>Check Your Submission:</strong>
          <ul>
            <li>Validate your submission format for any issues that could impact scoring.</li>
          </ul>
        </li>
        <li>
          <strong>Submit Answers:</strong>
          <ul>
            <li>Use the manual submission form below, or</li>
            <li>Submit via the API.</li>
            <li>Your submission will be validated using <a href="https://github.com/pyauth/tsp-client" target="_blank">TSP</a>.
              Store the full verification data via API response or button on top after submission.
            </li>
          </ul>
        </li>
        <li>
          <strong>Verify Submission with TSP:</strong>
          <ul>
            <li>Use the provided code snippet to verify your submission after uploading.</li>
          </ul>
        </li>
      </ol>
    </div>
  </div>

  <!-- Manual Submission -->
  <div class="collapsible-section">
    <button class="section-header">
      <svg class="arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <h2>Manual File Check & Submission</h2>
    </button>
    <div class="section-content">
      <form id="submissionForm">
        <label for="content">Enter submission JSON:</label><br><br>
        <textarea id="content" name="content" rows="11">
{
"team_name": "test-team",
"contact_mail_address": "test.team@rag-tat.com",
"submission":
    [
      { "question": "Q1", "schema": "name", "answer": "A1" },
      { "question": "Q2", "schema": "number", "answer": 2.5 },
      { "question": "Q2", "schema": "boolean", "answer": true },
      { "question": "Q2", "schema": "boolean", "answer": "n/a" }
    ]
}</textarea><br><br>
        <button type="button" id="checkButton">Check Submission</button>
        <button type="button" id="submitButton">Submit</button>
      </form>
      <div id="validation-issues"></div>
    </div>
  </div>


  <!-- Check Submission -->
  <div class="collapsible-section">
    <button class="section-header">
      <svg class="arrow collapsed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <h2>Check Submission Format via API</h2>
    </button>
    <div class="section-content hidden">
      <p>With curl:</p>
      <div class="code-container">
        <button class="copy-button copy-code-button" onclick="copyCode('curl-code-check')">
          Copy
        </button>
        <pre id="curl-code-check">
curl -X 'POST' \
  'http://127.0.0.1:8000/check-submission' \
  -H 'accept: application/json' \
  -H 'Content-Type: multipart/form-data' \
  -F 'file=@test/samples/sample_answer.json;type=application/json'
          </pre>
      </div>

      <p>With Python requests:</p>
      <div class="code-container">
        <button class="copy-button copy-code-button" onclick="copyCode('python-code-check')">
          Copy
        </button>
        <pre id="python-code-check">
import requests

SUBMISSION_JSON_PATH = r"test\samples\sample_answer.json"

def main():
    url = "http://127.0.0.1:8000/check-submission"
    headers = {"accept": "application/json"}
    files = {
        "file": ("sample_answer.json", open(SUBMISSION_JSON_PATH, "rb"), "application/json")
    }
    response = requests.post(url, headers=headers, files=files)
    assert response.status_code == 200
    print(response.json())

if __name__ == "__main__":
    main()
          </pre>
      </div>

    </div>
  </div>


  <!-- Submit via API -->
  <div class="collapsible-section">
    <button class="section-header">
      <svg class="arrow collapsed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <h2>Submit via API</h2>
    </button>
    <div class="section-content hidden">
      <p>Make sure to store the response (i.p. "tsp_verification_data") of the API call if you want to verify the
        submission via TSP.</p>
      <p>With curl:</p>
      <div class="code-container">
        <button class="copy-button copy-code-button" onclick="copyCode('curl-code-submit')">
          Copy
        </button>
        <pre id="curl-code-submit">
curl -X 'POST' \
  'http://127.0.0.1:8000/submit' \
  -H 'accept: application/json' \
  -H 'Content-Type: multipart/form-data' \
  -F 'file=@test/samples/sample_answer.json;type=application/json'
          </pre>
      </div>

      <p>With Python requests:</p>
      <div class="code-container">
        <button class="copy-button copy-code-button" onclick="copyCode('python-code-submit')">
          Copy
        </button>
        <pre id="python-code-submit">
import requests

SUBMISSION_JSON_PATH = r"test\samples\sample_answer.json"

def main():
    url = "http://127.0.0.1:8000/submit"
    headers = {"accept": "application/json"}
    files = {
        "file": ("sample_answer.json", open(SUBMISSION_JSON_PATH, "rb"), "application/json")
    }
    response = requests.post(url, headers=headers, files=files)
    assert response.status_code == 200
    print(response.json())

if __name__ == "__main__":
    main()
          </pre>
      </div>
    </div>
  </div>


  <!-- Verify submission with TSP -->
  <div class="collapsible-section">
    <button class="section-header">
      <svg class="arrow collapsed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <h2>Verify submission with TSP</h2>
    </button>
    <div class="section-content hidden">
      <p>Make sure to copy the verification data either with the button at the top when submitted via UI or from
        the terminal if submitted via API!</p>
      <p>With Python (requires <a href="https://github.com/pyauth/tsp-client" target="_blank">tsp-client</a> library):
      </p>
      <div class="code-container">
        <button class="copy-button copy-code-button" onclick="copyCode('python-tsp-code-submit')">
          Copy
        </button>
        <pre id="python-tsp-code-submit">
# paste verification data copied from UI here
tsp_verification_data = {}

signature = bytes.fromhex(tsp_verification_data['tsp_signature'])
server_digest = bytes.fromhex(tsp_verification_data['digest'])

submission_bytes = str(tsp_verification_data['submission']).encode("utf-8")
current_digest = hashlib.sha512(submission_bytes).digest()

assert current_digest == server_digest, ("Digest mismatch. Digest computed from "
 "submission data does not match the digest in the verification data. Check if "
 "the verification data is correct. Submit again if you suspect tampering.")

verified = TSPVerifier().verify(signature, message_digest=current_digest)

print("Submission timestamp:", verified.tst_info["gen_time"].strftime("%Y-%m-%d, %H:%M:%S"))
print(verified.signed_attrs)
# If there is no DigestMismatchError returned, the verification is successful.
          </pre>
      </div>
    </div>
  </div>


  <!-- Submissions Table -->
  <div class="collapsible-section">
    <button class="section-header">
      <svg class="arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <h2>Submissions Table</h2>
    </button>
    <div class="section-content">
      <button type="button" id="loadSubmissions" onclick="loadSubmissions()">Reload</button>
      <button type="button" id="loopLoadSubmissions" onclick="loopLoadSubmissions()">Reload every 2 sec</button>
      <table id="submissionsTable">
        <thead>
        <tr>
          <th>Time (UTC)</th>
          <th>Team Name</th>
          <th>Signature</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="footer">
  <a href="https://www.timetoact-group.at/" target="_blank"><img src="static/assets/TAT-WHITE_TIMETOACT-AT.png"
                                                                 alt="Logo"></a>
  <p>© 2025 TIMETOACT GROUP Österreich GmbH</p>
</div>

<script src="static/logic.js"></script>
</body>
</html>
