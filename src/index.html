<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8"/>
  <title>RAG Challenge Submission API</title>
  <link rel="icon" type="image/x-icon" href="static/assets/fav_ttg.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="static/style.css?v=1">
</head>
<body>
<div class="success-banner" id="successBanner">
  <span class="close-button" onclick="hideBanner()">×</span>
  <p><b>Answers submitted!</b></p>
  <p id="submission-data"></p>
  <p id="tsp-verification-data" style="display: none"></p>
  <button type="button" id="copy-tsp-button" class="copy-button" onclick="copyCode('tsp-verification-data')">
    Copy data for TSP verification
  </button>
</div>

<div class="header">
  <img src="static/assets/ERC_header_8.png" alt="Logo">
</div>

<div class="content">
  <h1>Enterprise RAG Challenge</h1>

  <div class="collapsible-section">
    <button class="section-header">
      <svg class="arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <h2>Submission API - Experiment Tracking Server</h2>
    </button>
    <div class="section-content" id="intro-text">

      <p>This is a friendly competition to build a RAG system that can read annual reports and answer questions.</p>
      <p><b>Update:</b> the competition part is over (<a href="https://www.timetoact-group.at/en/insights/the-winner-of-the-enterprise-rag-challenge">winner announcement</a>), but we are still running experiments! This experiment tracking server is guaranteed to run at least until April.</p>
      <ul>
        <li><a href="https://www.timetoact-group.at/details/enterprise-rag-challenge" target="_blank">Overview page</a> of challenge</li>
        <li><a href="https://www.timetoact-group.at/details/enterprise-rag-challenge#sign-up" target="_blank">Registration</a></li>
        <li><a href="https://github.com/trustbit/enterprise-rag-challenge/tree/main?tab=readme-ov-file#schema" target="_blank">Submission format description</a></li>
        <li><i>Optional but recommended</i>:
          <ul>
            <li><a href="https://rag.abdullin.com/data/r2.0-test/" target="_blank">Download</a> sample questions and data.</li>
          </ul>
          <ul>
            <li>Study <a href="https://github.com/trustbit/enterprise-rag-challenge/blob/main/main.py" target="_blank">source code</a> of the question generator.</li>
          </ul>
          <ul>
            <li>Generate your own test submission JSON and submit it below for a test.</li>
          </ul>
        </li>

        <li>Join us on February 27th at 10:00 AM UTC+1 on <a href="https://discord.gg/ZhtnBmta" target="_blank">Discord</a> for challenge data. It will be uploaded <a href="https://rag.abdullin.com/data/r2.0/" target="_blank">here</a>.</li>
        <li>Upload your competition submission and <a href="https://tally.so/r/mDZO1Z">fill in the questionnaire</a>. Anonymous participation is allowed, but you still must fill in the form.</li>
        <li>Multiple submissions from a team are allowed. Only the first submission counts for the prizes, but all submissions with questionnaire go to the leaderboard.</li>
      </ul>

    </div>
  </div>


  <!-- Instructions -->
  <div class="collapsible-section">
    <button class="section-header">
      <svg class="arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <h2>Submission Instructions</h2>
    </button>
    <div class="section-content" id="instructions-text">
      <ol>
        <li>
          <b>Adhere to the <a href="https://github.com/trustbit/enterprise-rag-challenge/tree/main?tab=readme-ov-file#schema" target="_blank">Submission Guidelines</a></b>
        </li>
        <li>
          <b>Check Your Submission</b>
          <ul>
            <li>Validate your submission format for any issues that could impact scoring.</li>
          </ul>
        </li>
        <li>
          <b>Submit Answers</b>
          <ul>
            <li>Use the manual submission form below, or</li>
            <li>Submit via the API.</li>
            <li>Your submission will be timestamped using <a href="https://github.com/pyauth/tsp-client" target="_blank">TSP</a>.
              <b>Store the full verification data</b> of the API response or via button after UI submission.
            </li>
            <li><b>Important!</b>Fill in a <a href="https://tally.so/r/mDZO1Z">short form on Tally</a> describing your submission. You will need to paste tsp_signature there.</li>
          </ul>
        </li>
        <li>
          <b>Verify Submission with TSP</b>
          <ul>
            <li>Use the provided code snippet to verify your submission after uploading.</li>
            <li>Make sure to store the tcp_verification_data from the UI or API response.</li>
          </ul>
        </li>
        <li>
          <b>Deadlines</b>
          <ul>
            <li><b>Prize deadline</b> - March 01, 00:00 UTC+1. Only submissions sent in February can be nominated for the prizes.</li>
            <li><b>Leaderboard deadline</b> - March 07, 10:00 UTC+1. Only submissions sent before we release the answers are accepted.</li>
          </ul>
        </li>
        <li>
          <b>Upload multiple submissions</b>
          <ul>
            <li>Uploading multiple submissions with different architectures and approaches is encouraged! All submissions with a filled form will go to the primary leaderboard.</li>
            <li>By default, the first submission from the team until the <b>prize deadline</b> (March 01, 00:00 UTC+1) is nominated for the prize. But until the deadline you can replace your nomination with a better but slower solution. Use <em>"Do you want to replace your previous prize submission?"</em> section in the form to do that.</li>
          </ul>
        </li>
      </ol>
    </div>
  </div>

  <!-- Manual Submission -->
  <div class="collapsible-section">
    <button class="section-header">
      <svg class="arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <h2>Manual File Check & Submission</h2>
    </button>
    <div class="section-content">
      <form id="submissionForm">
        <label for="content">Enter submission JSON:</label><br><br>
        <textarea id="content" name="content" rows="11">
{
"team_email": "test.team@rag-tat.com",
"submission_name": "test-team",
"answers":
    [
      { "value": "2", "references": [{"pdf_sha1": "053b7cb83115789346e2a9efc7e2e640851653ff", "page_index": 3}]},
      { "value": 2.5, "references": []},
      { "value": "no", "references": []}
    ]
}</textarea><br><br>
        <button type="button" id="checkButton">Check Submission</button>
        <button type="button" id="submitButton">Submit</button>
      </form>
      <div id="validation-issues"></div>
    </div>
  </div>


  <!-- Check Submission -->
  <div class="collapsible-section">
    <button class="section-header">
      <svg class="arrow collapsed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <h2>Check Submission Format via API</h2>
    </button>
    <div class="section-content hidden">
      <p>With curl:</p>
      <div class="code-container">
        <button class="copy-button copy-code-button" onclick="copyCode('curl-code-check')">
          Copy
        </button>
        <pre id="curl-code-check">
curl -X 'POST' \
  'https://rag.abdullin.com/check-submission' \
  -H 'accept: application/json' \
  -H 'Content-Type: multipart/form-data' \
  -F 'file=@test/samples/sample_answer.json;type=application/json'
          </pre>
      </div>

      <p>With Python requests:</p>
      <div class="code-container">
        <button class="copy-button copy-code-button" onclick="copyCode('python-code-check')">
          Copy
        </button>
        <pre id="python-code-check">
import requests

SUBMISSION_JSON_PATH = "test/samples/sample_answer.json"

def main():
    url = "https://rag.abdullin.com/check-submission"
    headers = {"accept": "application/json"}
    files = {
        "file": ("sample_answer.json", open(SUBMISSION_JSON_PATH, "rb"), "application/json")
    }
    response = requests.post(url, headers=headers, files=files)
    print(response.json())

if __name__ == "__main__":
    main()
          </pre>
      </div>

    </div>
  </div>


  <!-- Submit via API -->
  <div class="collapsible-section">
    <button class="section-header">
      <svg class="arrow collapsed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <h2>Submit via API</h2>
    </button>
    <div class="section-content hidden">
      <p>Make sure to store the response (i.p. "tsp_verification_data") of the API call if you want to verify the
        submission via TSP.</p>
      <p>With curl:</p>
      <div class="code-container">
        <button class="copy-button copy-code-button" onclick="copyCode('curl-code-submit')">
          Copy
        </button>
        <pre id="curl-code-submit">
curl -X 'POST' \
  'https://rag.abdullin.com/submit' \
  -H 'accept: application/json' \
  -H 'Content-Type: multipart/form-data' \
  -F 'file=@test/samples/sample_answer.json;type=application/json'
          </pre>
      </div>

      <p>With Python requests:</p>
      <div class="code-container">
        <button class="copy-button copy-code-button" onclick="copyCode('python-code-submit')">
          Copy
        </button>
        <pre id="python-code-submit">
import requests

SUBMISSION_JSON_PATH = "test/samples/sample_answer.json"

def main():
    url = "https://rag.abdullin.com/submit"
    headers = {"accept": "application/json"}
    files = {
        "file": ("sample_answer.json", open(SUBMISSION_JSON_PATH, "rb"), "application/json")
    }
    response = requests.post(url, headers=headers, files=files)
    print(response.json())

if __name__ == "__main__":
    main()
          </pre>
      </div>
    </div>
  </div>


  <!-- Verify submission with TSP -->
  <div class="collapsible-section">
    <button class="section-header">
      <svg class="arrow collapsed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <h2>Verify submission with TSP</h2>
    </button>
    <div class="section-content hidden">
      <p>Make sure to copy the verification data either with the button at the top when submitted via UI or from
        the API response!</p>
      <p>With Python (requires <a href="https://github.com/pyauth/tsp-client" target="_blank">tsp-client</a> library):
      </p>
      <div class="code-container">
        <button class="copy-button copy-code-button" onclick="copyCode('python-tsp-code-submit')">
          Copy
        </button>
        <pre id="python-tsp-code-submit">
import hashlib
from tsp_client import TSPVerifier

# PASTE TSP VERIFICATION DATA HERE (copied from UI or API response)
tsp_verification_data = {}

signature = bytes.fromhex(tsp_verification_data['tsp_signature'])
server_digest = bytes.fromhex(tsp_verification_data['submission_digest'])  # just fyi

submission_bytes = str(tsp_verification_data['submission']).encode("utf-8")
current_digest = hashlib.sha512(submission_bytes).digest()

try:
    verified = TSPVerifier().verify(signature, message_digest=current_digest)
    print("Submission timestamp:", verified.tst_info["gen_time"].strftime("%Y-%m-%d, %H:%M:%S"))
    print(verified.signed_attrs)
    print("Verification successful.")
except Exception as e:
    print("Verification failed:", e)
    print("Consider re-uploading your submission.")
          </pre>
      </div>
    </div>
  </div>


  <!-- Submissions Table -->
  <div class="collapsible-section">
    <button class="section-header">
      <svg class="arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <h2>Submissions Table</h2>
    </button>
    <div class="section-content">
      <button type="button" id="loadSubmissions" onclick="loadSubmissions()">Reload</button>
      <button type="button" id="loopLoadSubmissions" onclick="loopLoadSubmissions()">Reload every 2 sec</button>
      <table id="submissionsTable">
        <thead>
          <tr>
            <th>Time (UTC)</th>
            <th>Submission Name</th>
            <th>
              <span class="tooltip signature">
                Signature
                <span class="tooltiptext">first 64 characters of sha256 digest of the tsp_signature</span>
              </span>
            </th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="footer">
  <a href="https://www.timetoact-group.at/" target="_blank"><img src="static/assets/TAT-WHITE_TIMETOACT-AT.png"
                                                                 alt="Logo"></a>
  <p>© 2025 TIMETOACT GROUP Österreich GmbH</p>
</div>

<script src="static/logic.js"></script>
</body>
</html>
